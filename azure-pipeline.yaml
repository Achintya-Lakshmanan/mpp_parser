trigger:
  branches:
    include:
      - main
      - Dev

stages:
  - stage: Build
    displayName: 'Build and push stage'
    jobs:
      - job: Build
        displayName: 'Build and Push'
        pool:
          vmImage: 'ubuntu-latest'
        steps:
          - task: Docker@2
            displayName: Build and Push
            inputs:
              command: buildAndPush
              repository: 'lmtmpp-parserapp'
              dockerfile: 'Dockerfile'
              conatinerRegistry: 'turingACR'
              tags: latest
              
  - stage: Deploy
    displayName: 'Deploy to App Service'
    dependsOn: Build
    condition: succeeded()
    jobs:
    - job: Deploy
      displayName: Deploy to App Service
      steps:
      - task: AzureWebApp@1
        inputs:
         ConnectionType: 'AzureRM'
         azureSubscription: 'lmt-products'   
         appType: 'webAppContainer'
         WebAppName: 'lmtmpp-parserapp'
         DockerNamespace: 'turing.azurecr.io'
         DockerRepository: 'lmtmpp-parserapp'
         DockerImageTag: 'latest'
 
